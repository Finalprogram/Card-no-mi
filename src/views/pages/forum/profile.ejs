<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= profileUser.username %> - Perfil | Card no Mi</title>
    <link rel="stylesheet" href="/css/forum.css">
</head>
<body>
    <%- include('../../partials/header') %>
    <%- include('../../partials/navbar') %>

    <main class="forum-container">
        <!-- Breadcrumb -->
        <div class="forum-breadcrumb">
            <a href="/forum"><i class="fas fa-home"></i> F√≥rum</a>
            <span class="separator">/</span>
            <span class="current">Perfil de <%= profileUser.username %></span>
        </div>

        <!-- Profile Header -->
        <div class="profile-header">
            <div class="profile-header-content">
                <div class="profile-avatar-large">
                    <img src="<%= profileUser.avatar || '/images/default-avatar.png' %>" 
                         alt="<%= profileUser.username %>"
                         onerror="this.src='/images/default-avatar.png'">
                    <% if (profileUser.faction) { %>
                        <span class="profile-badge-overlay faction-overlay faction-<%= profileUser.faction %>" 
                              title="<%= profileUser.faction === 'pirate' ? 'Pirata' : 'Marinha' %>">
                            <%= profileUser.faction === 'pirate' ? 'üè¥‚Äç‚ò†Ô∏è' : '‚öì' %>
                        </span>
                    <% } %>
                </div>
                
                <div class="profile-info">
                    <h1 class="profile-username">
                        <%= profileUser.username %>
                        <% if (profileUser.role === 'admin') { %>
                            <span class="user-role-badge admin">üëë Admin</span>
                        <% } else if (profileUser.accountType === 'shop') { %>
                            <span class="user-role-badge seller">üè™ Loja</span>
                        <% } %>
                        <% if (profileUser.faction) { %>
                            <span class="user-badge faction-badge faction-<%= profileUser.faction %>">
                                <%= profileUser.faction === 'pirate' ? 'üè¥‚Äç‚ò†Ô∏è' : '‚öì' %>
                                <%= profileUser.faction === 'pirate' ? 'Pirata' : 'Marinha' %>
                            </span>
                        <% } %>
                    </h1>
                    
                    <% if (profileUser.faction && factionRankInfo) { %>
                        <div class="profile-faction-info">
                            <div class="faction-rank-display">
                                <span class="rank-icon"><%= profileUser.faction === 'pirate' ? '‚öîÔ∏è' : 'üéñÔ∏è' %></span>
                                <span class="rank-title"><%= factionRankInfo.title %></span>
                            </div>
                            <% if (profileUser.factionPoints > 0) { %>
                                <div class="faction-bounty-display">
                                    <span class="bounty-icon">üí∞</span>
                                    <span class="bounty-label">Bounty:</span>
                                    <span class="bounty-amount">‚Çø<%= (profileUser.factionPoints * 10000).toLocaleString('pt-BR') %></span>
                                </div>
                            <% } %>
                        </div>
                    <% } else if (profileUser.forumTitle) { %>
                        <div class="profile-custom-title"><%= profileUser.forumTitle %></div>
                    <% } %>
                    
                    <div class="profile-stats-inline">
                        <span class="stat-item">
                            <i class="fas fa-calendar"></i> Membro desde <%= memberSince %>
                        </span>
                        <% if (profileUser.location) { %>
                            <span class="stat-divider">‚Ä¢</span>
                            <span class="stat-item">
                                <i class="fas fa-map-marker-alt"></i> <%= profileUser.location %>
                            </span>
                        <% } %>
                    </div>

                    <% if (profileUser.bio) { %>
                        <p class="profile-bio"><%= profileUser.bio %></p>
                    <% } %>
                    
                    <!-- Social Links -->
                    <% if (profileUser.socialLinks && (profileUser.socialLinks.twitter || profileUser.socialLinks.instagram || profileUser.socialLinks.youtube || profileUser.socialLinks.twitch || profileUser.website)) { %>
                        <div class="profile-social-links">
                            <% if (profileUser.website) { %>
                                <a href="<%= profileUser.website %>" target="_blank" rel="noopener noreferrer" class="social-link">
                                    <i class="fas fa-globe"></i>
                                </a>
                            <% } %>
                            <% if (profileUser.socialLinks.twitter) { %>
                                <a href="https://twitter.com/<%= profileUser.socialLinks.twitter %>" target="_blank" rel="noopener noreferrer" class="social-link">
                                    <i class="fab fa-twitter"></i>
                                </a>
                            <% } %>
                            <% if (profileUser.socialLinks.instagram) { %>
                                <a href="https://instagram.com/<%= profileUser.socialLinks.instagram %>" target="_blank" rel="noopener noreferrer" class="social-link">
                                    <i class="fab fa-instagram"></i>
                                </a>
                            <% } %>
                            <% if (profileUser.socialLinks.youtube) { %>
                                <a href="https://youtube.com/@<%= profileUser.socialLinks.youtube %>" target="_blank" rel="noopener noreferrer" class="social-link">
                                    <i class="fab fa-youtube"></i>
                                </a>
                            <% } %>
                            <% if (profileUser.socialLinks.twitch) { %>
                                <a href="https://twitch.tv/<%= profileUser.socialLinks.twitch %>" target="_blank" rel="noopener noreferrer" class="social-link">
                                    <i class="fab fa-twitch"></i>
                                </a>
                            <% } %>
                        </div>
                    <% } %>
                    
                    <% if (isOwnProfile) { %>
                        <div class="profile-actions">
                            <a href="/forum/profile/edit" class="btn btn-primary">
                                <i class="fas fa-edit"></i> Editar Perfil
                            </a>
                            <a href="/perfil/<%= user._id || user.id %>" class="btn btn-secondary">
                                <i class="fas fa-store"></i> Perfil Marketplace
                            </a>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìù</div>
                <div class="stat-value"><%= threadCount %></div>
                <div class="stat-label">Threads Criadas</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí¨</div>
                <div class="stat-value"><%= postCount %></div>
                <div class="stat-label">Posts</div>
            </div>
            <% if (profileUser.faction && factionRankInfo) { %>
                <div class="stat-card faction-stat">
                    <div class="stat-icon"><%= profileUser.faction === 'pirate' ? '‚öîÔ∏è' : 'üéñÔ∏è' %></div>
                    <div class="stat-value"><%= factionRankInfo.title %></div>
                    <div class="stat-label"><%= profileUser.faction === 'pirate' ? 'Rank Pirata' : 'Patente Naval' %></div>
                </div>
                <div class="stat-card bounty-stat">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-value">‚Çø<%= (profileUser.factionPoints * 10000).toLocaleString('pt-BR') %></div>
                    <div class="stat-label">Bounty</div>
                </div>
            <% } else { %>
                <div class="stat-card">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-value"><%= reputationScore %></div>
                    <div class="stat-label">Reputa√ß√£o</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üèÖ</div>
                    <div class="stat-value"><%= reputationLevel %></div>
                    <div class="stat-label">N√≠vel</div>
                </div>
            <% } %>
        </div>

        <!-- Recent Activity -->
        <div class="profile-section">
            <h2 class="section-title">üìã Atividade Recente</h2>
            
            <div class="activity-tabs">
                <button class="activity-tab active" data-tab="threads">Threads</button>
                <button class="activity-tab" data-tab="posts">Posts</button>
            </div>

            <!-- Recent Threads -->
            <div class="activity-content" id="threads-content">
                <% if (recentThreads && recentThreads.length > 0) { %>
                    <div class="thread-list">
                        <% recentThreads.forEach(thread => { %>
                            <a href="/forum/<%= thread.category.slug %>/<%= thread.slug %>" class="thread-item">
                                <div class="thread-main">
                                    <div class="thread-title-row">
                                        <h3 class="thread-title">
                                            <% if (thread.isPinned) { %>
                                                <span class="thread-badge pinned">üìå Fixado</span>
                                            <% } %>
                                            <% if (thread.isLocked) { %>
                                                <span class="thread-badge locked">üîí Trancado</span>
                                            <% } %>
                                            <%= thread.title %>
                                        </h3>
                                    </div>
                                    
                                    <div class="thread-meta">
                                        <span class="thread-category" style="color: <%= thread.category.color %>">
                                            <%= thread.category.icon %> <%= thread.category.name %>
                                        </span>
                                        <span class="meta-divider">‚Ä¢</span>
                                        <span><%= new Date(thread.createdAt).toLocaleDateString('pt-BR') %></span>
                                        <% if (thread.tags && thread.tags.length > 0) { %>
                                            <span class="meta-divider">‚Ä¢</span>
                                            <% thread.tags.slice(0, 2).forEach(tag => { %>
                                                <span class="thread-tag"><%= tag %></span>
                                            <% }); %>
                                        <% } %>
                                    </div>
                                </div>
                                
                                <div class="thread-stats">
                                    <span class="stat" title="Visualiza√ß√µes">
                                        <i class="fas fa-eye"></i> <%= thread.viewCount || 0 %>
                                    </span>
                                    <span class="stat" title="Respostas">
                                        <i class="fas fa-comments"></i> <%= thread.postCount || 0 %>
                                    </span>
                                </div>
                            </a>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <p>üìù Nenhuma thread criada ainda</p>
                    </div>
                <% } %>
            </div>

            <!-- Recent Posts -->
            <div class="activity-content" id="posts-content" style="display: none;">
                <% if (recentPosts && recentPosts.length > 0) { %>
                    <div class="posts-list">
                        <% recentPosts.forEach(post => { %>
                            <div class="post-preview">
                                <div class="post-preview-header">
                                    <a href="/forum/<%= post.thread.category.slug %>/<%= post.thread.slug %>" class="post-thread-link">
                                        <%= post.thread.title %>
                                    </a>
                                    <span class="post-date"><%= new Date(post.createdAt).toLocaleDateString('pt-BR') %></span>
                                </div>
                                <div class="post-preview-content">
                                    <%= post.content.substring(0, 200) %><%= post.content.length > 200 ? '...' : '' %>
                                </div>
                                <div class="post-preview-footer">
                                    <a href="/forum/<%= post.thread.category.slug %>/<%= post.thread.slug %>#post-<%= post._id %>" class="view-post-link">
                                        Ver post ‚Üí
                                    </a>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                <% } else { %>
                    <div class="empty-state">
                        <p>üí¨ Nenhum post criado ainda</p>
                    </div>
                <% } %>
            </div>
        </div>
    </main>

    <%- include('../../partials/footer') %>

    <script>
        // Tab switching
        document.querySelectorAll('.activity-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs
                document.querySelectorAll('.activity-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all content
                document.querySelectorAll('.activity-content').forEach(c => c.style.display = 'none');
                
                // Show selected content
                const tabName = this.dataset.tab;
                document.getElementById(tabName + '-content').style.display = 'block';
            });
        });
    </script>
</body>
</html>
