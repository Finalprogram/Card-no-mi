<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <%- include('../partials/header') %>
    <title><%= title %></title>
    
    <!-- Google Fonts: Bebas Neue para títulos, Poppins para corpo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- CSS Atualizado -->
    <link rel="stylesheet" href="/css/deck-builder.css">

    <!-- Biblioteca de Ícones (Phosphor Icons) -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
</head>
<body>
    <%- include('../partials/navbar') %>

    <!-- Container principal com o novo layout -->
    <div class="deck-builder-container">
        
        <!-- Coluna da Esquerda: Busca de Cartas -->
        <aside class="sidebar panel-fade-in">
            <header class="sidebar-header">
                <h2><i class="ph-bold ph-magnifying-glass"></i> Buscar Cartas</h2>
            </header>
            <div class="search-bar">
                <input type="text" id="card-search-input" placeholder="Digite o nome da carta..." <%= !isOwner ? 'disabled' : '' %>>
                <div id="search-loader" class="loader" style="display: none;"></div>
            </div>
            <div id="search-results" class="search-results">
                <p class="placeholder-text">Busque por uma carta para começar!</p>
            </div>
        </aside>
        
        <!-- Coluna da Direita: Construção do Deck -->
        <main class="main-content panel-slide-in">
            <header class="deck-header">
                <h1><i class="ph-bold ph-scroll"></i> Meu Deck</h1>
                <div class="deck-actions">
                    <% if (isOwner) { %>
                        <button id="import-deck-btn" class="btn btn-secondary"><i class="ph-bold ph-upload-simple"></i> Importar</button>
                    <% } %>
                    <button id="export-deck-btn" class="btn btn-secondary"><i class="ph-bold ph-download-simple"></i> Exportar</button>
                </div>
            </header>

            <!-- Detalhes do Deck -->
            <section class="deck-details">
                <input type="text" id="deck-title" placeholder="Título do Deck" value="<%= deck ? deck.title : '' %>" <%= !isOwner ? 'disabled' : '' %>/>
                <textarea id="deck-description" placeholder="Adicione uma breve descrição..." <%= !isOwner ? 'disabled' : '' %>><%= deck ? deck.description : '' %></textarea>
                <div class="deck-privacy">
                    <input type="checkbox" id="deck-is-public" name="isPublic" <%= deck && deck.isPublic ? 'checked' : '' %> <%= !isOwner ? 'disabled' : '' %>/>
                    <label for="deck-is-public">Deck público</label>
                </div>
            </section>

            <!-- Nova Seção do Líder -->
            <section id="leader-section-container" class="leader-section">
                <!-- O conteúdo (placeholder ou card do líder) será renderizado aqui pelo deck-builder.js -->
            </section>

            <!-- Separador Sutil -->
            <div class="section-separator"></div>

            <!-- Abas de Visualização -->
            <div class="deck-view-tabs">
                <button class="tab-btn active" data-view="padrão">Padrão</button>
                <button class="tab-btn" data-view="raridade">Raridade</button>
                <button class="tab-btn" data-view="grid">Grid</button>
            </div>

            <!-- Grid do Deck -->
            <div id="deck-view-container" class="deck-grid">
                <!-- Conteúdo do deck renderizado por deck-builder.js -->
            </div>
            <div id="validation-summary"></div>

            <!-- Rodapé com Resumo Financeiro e Ação Principal -->
            <footer class="deck-footer">
                <div id="financial-summary" class="financial-summary">
                    <h3><i class="ph-bold ph-coins"></i> Resumo Financeiro</h3>
                    <div class="summary-item">
                        <span>Disponível:</span>
                        <span id="available-price" class="price">R$ 0,00</span>
                    </div>
                     <div class="summary-item">
                        <span>Total:</span>
                        <span id="total-price" class="price">R$ 0,00</span>
                    </div>
                </div>
                <% if (isOwner) { %>
                    <button id="save-deck-btn" class="btn btn-primary"><i class="ph-bold ph-floppy-disk"></i> <%= deck ? 'Salvar Alterações' : 'Salvar Deck' %></button>
                <% } %>
            </footer>
        </main>
    </div>

    <!-- Modal de Importação -->
    <div id="import-deck-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Importar Deck</h2>
            <textarea id="deck-import-textarea" placeholder="Cole a lista do seu deck aqui...

Exemplo:
1x OP01-001
4x OP01-002
..."></textarea>
            <button id="import-deck-confirm-btn" class="btn btn-primary">Importar</button>
        </div>
    </div>

    <!-- Modal de Detalhes da Carta -->
    <div id="card-detail-modal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <button class="close-btn" aria-label="Fechar">&times;</button>
            <div id="card-detail-content">
                <!-- Conteúdo será preenchido via JS -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="toast"></div>

    <%- include('../partials/footer') %>
    
    <script>
        const initialDeck = <%- JSON.stringify(deck || null) %>;
        window.isOwner = <%= isOwner %>;
    </script>
    <script src="/js/deck-builder.js"></script> 
</body>
</html>