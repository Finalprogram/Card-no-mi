<%# views/pages/decks.ejs %>
<%- include('../partials/header', { page_css: 'decks-ui.css' }) %>
<%- include('../partials/navbar') %>

<div class="decks-page">
    <main class="container">
        <header class="decks-header">
            <h1>Meus Decks</h1>
            <a href="/deck-builder" id="create-deck-btn" class="btn btn-primary">
                <i class="fas fa-plus"></i> Criar Novo Deck
            </a>
        </header>

        <section class="decks-toolbar">
            <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input type="search" id="deck-search-input" placeholder="Buscar por nome do deck...">
            </div>
            <div class="filter-wrapper">
                <select id="deck-sort-order">
                    <option value="date-desc">Mais Recentes</option>
                    <option value="date-asc">Mais Antigos</option>
                    <option value="name-asc">Nome (A-Z)</option>
                </select>
            </div>
        </section>

        <section id="deck-list" class="deck-grid" aria-live="polite">
            <% if (decks && decks.length > 0) { %>
                <% decks.forEach(deck => { %>
                    <article class="deck-card" data-deck-id="<%= deck._id %>" draggable="true">
                        <div class="deck-card-content">
                            <h3 class="deck-card-title"><%= deck.title %></h3>
                            <div class="deck-card-meta">
                                <span><i class="fas fa-layer-group"></i> <%= deck.main.reduce((sum, item) => sum + item.quantity, 0) %> cartas</span>
                            </div>
                            <div class="deck-card-badges">
                                <% if (deck.isPublic) { %>
                                    <span class="badge public">Público</span>
                                <% } else { %>
                                    <span class="badge private">Privado</span>
                                <% } %>
                            </div>
                        </div>
                        <div class="deck-card-actions">
                            <button class="icon-btn view-btn" title="Visualização Rápida"><i class="fas fa-eye"></i></button>
                            <button class="icon-btn edit-btn" title="Editar"><i class="fas fa-pen"></i></button>
                            <button class="icon-btn duplicate-btn" title="Duplicar"><i class="fas fa-copy"></i></button>
                            <button class="icon-btn delete-btn" title="Excluir"><i class="fas fa-trash"></i></button>
                        </div>
                    </article>
                <% }); %>
            <% } else { %>
                <div class="no-decks-message">
                    <p>Você ainda não criou nenhum deck.</p>
                    <p>Clique em "Criar Novo Deck" para começar!</p>
                </div>
            <% } %>
        </section>

        <div class="skeleton-grid">
             <%# Placeholder for loading state %>
        </div>
    </main>

    <%# Side Drawer for Quick View %>
    <aside id="deck-drawer" class="deck-drawer" aria-hidden="true">
        <div class="drawer-header">
            <h2 id="drawer-title">Deck Details</h2>
            <button id="drawer-close-btn" class="icon-btn" aria-label="Fechar"><i class="fas fa-times"></i></button>
        </div>
        <div id="drawer-content" class="drawer-content">
            <%# Content will be injected by JS %>
        </div>
    </aside>

    <%# Modal for Deletion Confirmation %>
    <div id="delete-deck-modal" class="modal-overlay" hidden>
        <div class="modal-content" role="dialog" aria-labelledby="delete-deck-modal-title">
            <h2 id="delete-deck-modal-title">Confirmar Exclusão</h2>
            <p>Você realmente deseja deletar o deck "<span id="deck-name-to-delete"></span>"?</p>
            <div class="form-actions">
                <button type="button" id="delete-deck-cancel-btn" class="btn btn-secondary">Cancelar</button>
                <button type="button" id="delete-deck-confirm-btn" class="btn btn-danger">Excluir</button>
            </div>
        </div>
    </div>

    <%# New elements for Leader Selection Modal %>
    <div id="leader-selection-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Selecionar Líder</h2>
            <div class="leader-filters">
                <input type="text" id="leader-search-input" placeholder="Buscar líder...">
                <select id="leader-color-filter">
                    <option value="">Todas as Cores</option>
                    <option value="red">Vermelho</option>
                    <option value="green">Verde</option>
                    <option value="blue">Azul</option>
                    <option value="black">Preto</option>
                    <option value="yellow">Amarelo</option>
                    <option value="purple">Roxo</option>
                </select>
                <select id="leader-edition-filter">
                    <option value="">Todas as Edições</option>
                    <%# Options will be populated by JS %>
                </select>
            </div>
            <div id="leader-gallery" class="leader-gallery">
                <p class="placeholder-text">Carregando líderes...</p>
            </div>
        </div>
    </div>
</div>

<%# Toast Notifications Container %>
<div id="toast-container"></div>

<%- include('../partials/footer') %>
<script src="/js/decks-ui.js"></script>