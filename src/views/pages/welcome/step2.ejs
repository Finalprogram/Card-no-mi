<!DOCTYPE html>

<html lang="pt-br">

<head>

    <%- include('../../partials/header') %>

    <title>Configuração de Endereço - Card-no-mi</title>

    <style>

        .progress-container {

            width: 100%;

            background-color: #e0e0e0;

            border-radius: 5px;

            margin: 1rem 0;

        }

        .progress-bar {

            width: 0;

            height: 10px;

            background-color: #6a0dad; /* Roxo */

            border-radius: 5px;

            transition: width 0.5s ease-in-out;

        }

        .step-label {

            text-align: center;

            font-size: 0.9rem;

            color: #666;

        }

    </style>

</head>

<body class="auth-body">

    <div class="container">

        <%- include('../../partials/navbar') %>

    </div>

    <main class="container">

        <div class="glass-panel">

            <h1>Endereço de Envio</h1>

            <div class="progress-container">

                <div class="progress-bar" style="width: <%= isStore ? '66%' : '100%' %>;"></div>

            </div>

            <p class="step-label">Passo 2 de <%= isStore ? 3 : 2 %></p>

            <p class="subtitle">Este endereço será usado como origem para o cálculo de fretes.</p>



            <form action="/welcome/step2" method="POST">

                <div class="form-group">

                    <label>CEP</label>

                    <input class="form-control" name="cep" id="cep" placeholder="00000-000" required>

                </div>

                <div class="form-group">

                    <label>Rua / Avenida</label>

                    <input class="form-control" name="street" id="street" placeholder="Sua rua ou avenida" required>

                </div>

                <div class="form-group">

                    <label>Bairro</label>

                    <input class="form-control" name="neighborhood" id="neighborhood" placeholder="Seu bairro" required>

                </div>

                <div class="form-row">

                    <div class="form-group">

                        <label>Número</label>

                        <input class="form-control" name="number" required>

                    </div>

                    <div class="form-group">

                        <label>Complemento (opcional)</label>

                        <input class="form-control" name="complement">

                    </div>

                </div>

                <div class="form-row">

                    <div class="form-group city-group">

                        <label>Cidade</label>

                        <input class="form-control" name="city" id="city" required>

                    </div>

                    <div class="form-group state-group">

                        <label>UF</label>

                        <input class="form-control" name="state" id="state" maxlength="2" required>

                    </div>

                </div>

                <button type="submit" class="btn-primary btn-submit-full">Próximo</button>

            </form>

        </div>

    </main>

    <script>

    document.addEventListener('DOMContentLoaded', () => {

        const cepInput = document.getElementById('cep');

        const streetInput = document.getElementById('street');

        const neighborhoodInput = document.getElementById('neighborhood');

        const cityInput = document.getElementById('city');

        const stateInput = document.getElementById('state');



        cepInput.addEventListener('blur', async () => {

            const cep = cepInput.value.replace(/\D/g, '');



            if (cep.length === 8) {

                try {

                    const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);

                    const data = await response.json();



                    if (!data.erro) {

                        streetInput.value = data.logradouro;

                        neighborhoodInput.value = data.bairro;

                        cityInput.value = data.localidade;

                        stateInput.value = data.uf;



                        streetInput.readOnly = true;

                        cityInput.readOnly = true;

                        stateInput.readOnly = true;

                    } else {

                        clearAddressFields();

                        alert('CEP não encontrado.');

                    }

                } catch (error) {

                    console.error('Erro ao buscar CEP:', error);

                    clearAddressFields();

                    alert('Erro ao buscar CEP. Tente novamente.');

                }

            } else {

                clearAddressFields();

            }

        });



        function clearAddressFields() {

            streetInput.value = '';

            neighborhoodInput.value = '';

            cityInput.value = '';

            stateInput.value = '';



            streetInput.readOnly = false;

            cityInput.readOnly = false;

            stateInput.readOnly = false;

        }

    });

    </script>

</body>

</html>
