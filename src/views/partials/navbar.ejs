<header class="navbar-wrapper">

  <div class="container">

    <nav class="navbar">
  <a href="/" class="navbar-logo-link">
    <img src="/images/Horizontal.png" alt="Logo Car'D No Mi" class="navbar-logo-img">
  </a>

      <ul class="navbar-menu">
    <li class="navbar-dropdown">
      <a href="#" class="dropdown-toggle-navbar">
        Explorar Cartas
        <span class="dropdown-arrow">‚ñº</span>
      </a>
      <div class="dropdown-menu-navbar">
        <a href="/cards" class="dropdown-item-navbar">Cartas √† Venda</a>
        <a href="/encyclopedia" class="dropdown-item-navbar">Enciclop√©dia</a>
      </div>
    </li>
    <li><a href="/decks/community">Deck Builder</a></li>
    <li class="navbar-dropdown">
      <a href="#" class="dropdown-toggle-navbar">
        Comunidade
        <span class="dropdown-arrow">‚ñº</span>
      </a>
      <div class="dropdown-menu-navbar">
        <a href="/comunidade" class="dropdown-item-navbar">P√°gina da Comunidade</a>
        <a href="/forum" class="dropdown-item-navbar">F√≥rum</a>
      </div>
    </li>
    <li><a href="/about">Sobre</a></li>
    <% if (user && (user.role === 'moderator' || user.role === 'admin')) { %>
    <li>
      <a href="/forum/moderation" class="moderation-link">
        üõ°Ô∏è Modera√ß√£o
        <% if (user.pendingReportsCount && user.pendingReportsCount > 0) { %>
          <span class="report-badge"><%= user.pendingReportsCount %></span>
        <% } %>
      </a>
    </li>
    <% } %>
</ul>

      <div class="navbar-actions">
          <% if (user) { %>
              <!-- Notifica√ß√µes -->
              <a href="/forum/notifications" class="notification-bell">
                  <i class="fas fa-bell"></i>
                  <span class="notification-badge" style="display: none;">0</span>
              </a>
              
              <a href="/vender" class="btn-primary btn-sell-now-navbar">Vender Agora</a>
              <div class="user-dropdown">
                  <div class="dropdown-toggle">
                      <img src="<%= user.avatar || '/images/default-avatar.png' %>" alt="Avatar do usu√°rio" class="avatar">
                      <span class="navbar-user-greeting"><%= user.username %></span>
                      <span class="dropdown-arrow">‚ñº</span>
                  </div>
                  <div class="dropdown-menu">
                      <a href="/forum/user/<%= user.username %>" class="dropdown-item">
                          <i class="fas fa-user"></i> Perfil do F√≥rum
                      </a>
                      <a href="/forum/notifications" class="dropdown-item">
                          <i class="fas fa-bell"></i> Notifica√ß√µes
                      </a>
                      <div class="dropdown-divider"></div>
                      <a href="/perfil/<%= user.id %>" class="dropdown-item">Meu Perfil</a>
                      <a href="/meus-anuncios" class="dropdown-item">Meus An√∫ncios</a>
                      <a href="/meus-pedidos" class="dropdown-item">Minhas Compras</a>
                      <a href="/meus-pedidos-vendidos" class="dropdown-item">Minhas Vendas</a>
                      <a href="/dashboard-vendedor" class="dropdown-item">Dashboard</a>
                      <div class="dropdown-divider"></div>
                      <a href="/auth/logout" class="dropdown-item logout-btn">Sair</a>
                  </div>
              </div>
              
              <!-- Script para atualizar notifica√ß√µes -->
              <script>
                async function updateNotificationCount() {
                  try {
                    const response = await fetch('/forum/api/notifications/unread-count');
                    const data = await response.json();
                    const badge = document.querySelector('.notification-badge');
                    if (badge && data.count !== undefined) {
                      if (data.count > 0) {
                        badge.textContent = data.count > 99 ? '99+' : data.count;
                        badge.style.display = 'block';
                      } else {
                        badge.style.display = 'none';
                      }
                    }
                  } catch (error) {
                    console.error('Erro ao buscar notifica√ß√µes:', error);
                  }
                }
                
                // Atualizar ao carregar a p√°gina
                updateNotificationCount();
                
                // Atualizar a cada 30 segundos
                setInterval(updateNotificationCount, 30000);
              </script>
          <% } else { %>
              <a href="/auth/login" class="btn-secondary">Entrar</a>
              <a href="/auth/register" class="btn-primary">Cadastrar</a>
          <% } %>
      </div>
    </nav>
    
  </div>
</header>